# 刚体接触仿真平台技术调研与开发规划

## 项目概述
开发一个基于 **符号距离场(SDF)** 和 **IPC(Incremental Potential Contact, 增强势能接触)** 算法的高性能刚体接触仿真平台，使用隐式时间积分器，支持复杂几何接触和约束系统。

## 核心技术栈
- **几何表示**: 符号距离场(Signed Distance Field)
- **接触算法**: IPC (Incremental Potential Contact) - 基于屏障函数(barrier function)的无摩擦/摩擦接触
- **时间积分**: 隐式欧拉或其他隐式积分方案
- **约束系统**: 运动副(关节)约束 + 驱动器
- **开发语言**: C++ (建议C++17/20)，配合Eigen进行线性代数运算

## 需要你完成的工作

### Phase 1: 技术调研与架构设计 (调研深度报告)

#### 1.1 IPC算法核心原理调研
- [ ] IPC的数学基础：屏障函数(barrier function)接触势能公式
- [ ] 距离查询与SDF集成方式
- [ ] CCD(Continuous Collision Detection)在IPC中的必要性
- [ ] 摩擦模型：切向摩擦势能的构造方法
- [ ] 参考实现：分析ipc-toolkit (github.com/ipc-sim/ipc-toolkit) 的架构

#### 1.2 SDF(符号距离场)技术选型
- [ ] SDF生成算法：快速行进法(Fast Marching Method) vs 其他方法
- [ ] 高精度SDF查询与梯度计算
- [ ] 刚体SDF的刚体变换(旋转+平移)高效更新策略
- [ ] 复杂网格(mesh)到SDF的转换方案

#### 1.3 隐式积分器设计
- [ ] 隐式欧拉积分的非线性方程构建
- [ ] Newton-Raphson迭代求解器设计
- [ ] 线性系统求解：稀疏直接求解器(SuiteSparse) vs 迭代求解器
- [ ] 与IPC势能的梯度(力)和Hessian(刚度)计算集成

#### 1.4 约束系统数学建模
- [ ] 固定副(Fixed Joint): 完整约束方程
- [ ] 旋转副(Revolute Joint): 1自由度旋转约束，轴对齐处理
- [ ] 平移副(Prismatic Joint): 1自由度平移约束
- [ ] 球铰(Spherical Joint): 3自由度点重合约束
- [ ] 万向节(Universal Joint): 双轴旋转约束
- [ ] 约束的Lagrange乘子法或Baumgarte稳定化实现

#### 1.5 驱动器系统
- [ ] 位置驱动：目标位置/角度的PD控制或约束直接驱动
- [ ] 力/力矩驱动：直接施加广义力
- [ ] 速度驱动：速度级约束实现

### Phase 2: 系统架构设计

#### 2.1 核心类结构设计
设计以下核心模块的C++类接口：

```cpp
// 示例框架，需要你完善
class RigidBody {
    // 质量属性、SDF几何、位姿状态
};

class SDFGeometry {
    // SDF数据存储、查询、变换
};

class IPCContactModel {
    // 屏障函数参数、接触势能计算、梯度/Hessian
};

class ImplicitIntegrator {
    // 隐式积分主循环、Newton求解器
};

class JointConstraint {
    // 约束方程、Jacobian计算、Baumgarte稳定化
};

class ConstraintSolver {
    // 约束满足求解(与IPC耦合或分离)
};

class SimulationWorld {
    // 主仿真循环、对象管理、驱动器接口
};
```

#### 2.2 关键算法流程
- [ ] 单时间步长算法流程图(从隐式积分到接触求解的完整流程)
- [ ] SDF查询与IPC距离计算的集成点
- [ ] 约束与接触冲突处理策略(软约束vs硬约束优先级)

#### 2.3 性能优化策略
- [ ] SDF的空间哈希或BVH加速
- [ ] 接触对的宽相(wide-phase)筛选
- [ ] 矩阵稀疏模式利用
- [ ] 并行化策略(OpenMP/TBB)

### Phase 3: 开发路线图与里程碑

#### 3.1 分阶段实现计划
- **M1 (基础框架)**: 刚体状态管理、基础SDF、显式积分器
- **M2 (隐式积分)**: 隐式欧拉、Newton求解器、线性代数基础设施
- **M3 (IPC接触)**: 屏障函数实现、点到SDF距离查询、无摩擦接触
- **M4 (约束系统)**: 基础运动副实现、Lagrange乘子求解器
- **M5 (高级特性)**: 摩擦模型、驱动器系统、复杂关节链
- **M6 (优化与验证)**: 性能优化、标准测试场景、单元测试

#### 3.2 依赖库推荐
- 线性代数：Eigen3
- 稀疏求解：SuiteSparse (UMFPACK/Cholmod) 或 Intel MKL Pardiso
- SDF计算：OpenVDB (工业级) 或自研快速行进
- 几何处理：libigl 或 CGAL (用于mesh-to-SDF)
- 可选：TBB (并行), spdlog (日志)

#### 3.3 验证测试方案
- [ ] 自由落体球体弹跳(能量守恒验证)
- [ ] 斜面滑块(摩擦验证)
- [ ] 双摆系统(约束稳定性验证)
- [ ] 齿轮啮合(复杂接触验证)

## 输出要求

请提供以下交付物：

1. **技术调研报告** (详细)：
   - IPC算法的完整数学推导(势能函数、梯度、Hessian)
   - SDF与IPC集成的具体技术方案
   - 隐式积分+约束的数值方法选择依据

2. **系统架构文档**：
   - 完整C++类图(PlantUML或文字描述)
   - 关键接口定义(header文件形式)
   - 算法流程伪代码

3. **开发路线图**：
   - 详细的里程碑计划(建议8-12周)
   - 每个阶段的输入输出定义
   - 风险点识别与应对策略

4. **核心算法伪代码**：
   - 单步隐式积分+IPC求解流程
   - SDF查询与距离计算
   - 约束Jacobian计算示例(以旋转副为例)

5. **参考资源清单**：
   - 关键论文(IPC原始论文、SDF应用等)
   - 开源代码参考(ipc-toolkit, Chrono::Engine等)
   - 推荐教材/教程

## 约束条件
- 代码必须现代C++ (RAII, 智能指针, 模板元编程适度使用)
- 数值稳定性优先于性能(初始版本)
- 支持3D仿真(非2D)
- 文档与代码同步生成
